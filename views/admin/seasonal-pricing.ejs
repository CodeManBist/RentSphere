<%- layout("/layouts/boilerplate") %>

<style>
    .admin-header {
        background: linear-gradient(135deg, #fe424d 0%, #c62828 100%);
        color: white;
        padding: 2rem;
        border-radius: 1rem;
        margin-bottom: 2rem;
    }
    .admin-nav {
        background: white;
        border-radius: 1rem;
        padding: 1rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 2rem;
    }
    .admin-nav-link {
        padding: 0.75rem 1.25rem;
        border-radius: 0.5rem;
        color: #4b5563;
        text-decoration: none;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    .admin-nav-link:hover, .admin-nav-link.active {
        background: #fe424d;
        color: white;
    }
    .pricing-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .season-badge {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 600;
    }
    .season-peak { background: #fee2e2; color: #991b1b; }
    .season-summer { background: #fef3c7; color: #92400e; }
    .season-monsoon { background: #dbeafe; color: #1e40af; }
    .season-regular { background: #d1fae5; color: #065f46; }
    .multiplier-display {
        font-size: 2rem;
        font-weight: 700;
    }
</style>

<div class="container py-4">
    <div class="admin-header">
        <h1 class="mb-1"><i class="fa-solid fa-tags me-2"></i>Seasonal Pricing</h1>
        <p class="mb-0 opacity-75">View platform pricing rules</p>
    </div>

    <!-- Admin Navigation -->
    <div class="admin-nav">
        <div class="d-flex flex-wrap gap-2">
            <a href="/admin/dashboard" class="admin-nav-link">
                <i class="fa-solid fa-chart-line"></i> Dashboard
            </a>
            <a href="/admin/users" class="admin-nav-link">
                <i class="fa-solid fa-users"></i> Users
            </a>
            <a href="/admin/bookings" class="admin-nav-link">
                <i class="fa-solid fa-calendar-check"></i> Bookings
            </a>
            <a href="/admin/reviews" class="admin-nav-link">
                <i class="fa-solid fa-star"></i> Reviews
            </a>
            <a href="/admin/seasonal-pricing" class="admin-nav-link active">
                <i class="fa-solid fa-tags"></i> Pricing Rules
            </a>
            <a href="/admin/payment-logs" class="admin-nav-link">
                <i class="fa-solid fa-credit-card"></i> Payments
            </a>
        </div>
    </div>

    <!-- Global Pricing Rules -->
    <div class="pricing-card">
        <h4 class="mb-4"><i class="fa-solid fa-globe me-2"></i>Global Seasonal Pricing Rules</h4>
        <div class="row g-4">
            <% Object.entries(globalConfig).forEach(([key, season]) => { %>
            <div class="col-md-6 col-lg-3">
                <div class="season-badge season-<%= key %> mb-3">
                    <%= season.name %>
                </div>
                <p class="multiplier-display mb-1">
                    <%= season.multiplier > 1 ? '+' : '' %><%= Math.round((season.multiplier - 1) * 100) %>%
                </p>
                <p class="text-muted mb-0">
                    Months: <%= season.months.join(', ') %>
                </p>
            </div>
            <% }); %>
        </div>
        <div class="mt-4 p-3 bg-light rounded">
            <p class="mb-0">
                <i class="fa-solid fa-info-circle me-2 text-primary"></i>
                <strong>Weekend Surcharge:</strong> +10% applied on Saturdays and Sundays
            </p>
        </div>
    </div>

    <!-- Custom Rules -->
    <div class="pricing-card">
        <h4 class="mb-4"><i class="fa-solid fa-sliders me-2"></i>Host Custom Pricing Rules</h4>
        <% if (customRules.length > 0) { %>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Listing</th>
                        <th>Host</th>
                        <th>Rule Name</th>
                        <th>Type</th>
                        <th>Multiplier</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <% customRules.forEach(rule => { %>
                    <tr>
                        <td><%= rule.listing ? rule.listing.title : 'Deleted' %></td>
                        <td><%= rule.owner ? rule.owner.username : 'N/A' %></td>
                        <td><%= rule.name %></td>
                        <td><span class="badge bg-secondary"><%= rule.type %></span></td>
                        <td><strong><%= rule.multiplier %>x</strong></td>
                        <td>
                            <span class="badge <%= rule.isActive ? 'bg-success' : 'bg-secondary' %>">
                                <%= rule.isActive ? 'Active' : 'Inactive' %>
                            </span>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>
        <% } else { %>
        <p class="text-muted text-center py-4">No custom pricing rules configured by hosts</p>
        <% } %>
    </div>
</div>
